<?phpinclude "siteroot.php";/** * this is the scrip that does all the neccessary logic to register a user; * and store the users name and email in a session; * the first step was to start a session; * second to retrieve posted data; * third create the table which you should do already not in production; * fourth insert retrieved values from user; * fifth query for the inserted value using the id from the inserted data; * sixth store the data to the session and redirect user; * use these as a template for deciding on your own logic; * needed improvement implement checks on the client and server side for incomplete or inappropriate * values provided * *///constants to identify error using code in exception/****define('TABLE_CREATE_ERROR', 201);define('INSERT_ERROR', 202);define('QUERY_ERROR', 203);define('CLIENT_ERROR', 101);$error = "";if (isset($_POST["submit"])) {    $email = $_POST["email"];    $password1 = $_POST["password"];    $password2 = $_POST["password2"];        //code to establish a mysqli not mysql connection fill in the necessary data you    //can think of a better way to seperate this functionality    $mysqli = new mysqli("localhost", "root", "Virtual23", "today");//check connection for error    if ($mysqli->connect_errno) {        echo "Failed to connect to MySQL: " . $mysqli->connect_error;    }    try {        createUserTable();        $insertId = insertUser( $email, $password1, $password2);        $result=userQuery($insertId);        $mysqli->close();        if(isset($result["email"])){        $_SESSION["email"]=$result["email"];        redirect_to("login.php");        }               } catch (Exception $e) {        echo $e->getMessage();    }}***///function userQuery($email, $password) {/*global $mysqli;if ($result = $mysqli->query("SELECT `email` FROM `user` WHERE email=".$email." AND password=".$password." ")) {    $row = $result->fetch_assoc();    //use the $row array variable to fetch the data    returntriptriptrip $row;} else {    throw new Exception("query failed", QUERY_ERROR);}*/$mysqli = new mysqli("localhost", "root", "", "test");if ($mysqli->connect_errno) {    die("Failed to connect to MySQL: " . $mysqli->connect_error);}if (isset($_POST['email']) && isset($_POST['password'])) {    $email = $_POST["email"];    $pass = $_POST["password"];    $user=login($email,$password);    if(!$_SESSION){        session_start();    }    session_regenerate_id();    $_SESSION['id'] = $user['id'];    $_SESSION['email']=$user['email'];    header("Location:booking.php");    exit();}function login($email, $password){    global $mysqli;    if (!empty($email) && !empty($password)) {        $stmt = $mysqli->prepare("SELECT id,email FROM user WHERE email=? AND password=? LIMIT 1");        if ($stmt) {            $stmt->bind_param("ss", $email, md5($password));            if (!$stmt->execute()) {                throw new Exception("Invalid Credentials");            }            $stmt->bind_result($id,$email);            if ($stmt->num_rows > 0) {                while($stmt->fetch()){                $result=array("id"=>$id,"email"=>$email);                }                $stmt->close();                return $result;            }else{throw new Exception("Invalid Credential");}        }        $mysqli->close();    }}?>	